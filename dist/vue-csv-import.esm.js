import e from"lodash/merge";import{reactive as a,computed as t,provide as s,renderSlot as l,inject as r,openBlock as o,createElementBlock as u,Fragment as n,renderList as i,normalizeProps as p,guardReactiveProps as m,toDisplayString as d,ref as v,watch as c,createElementVNode as f,mergeProps as b,createCommentVNode as C,withDirectives as g,vModelSelect as y,createTextVNode as h,withModifiers as V}from"vue";import I from"lodash/drop";import x from"lodash/every";import H from"lodash/forEach";import D from"lodash/get";import M from"lodash/isArray";import k from"lodash/map";import w from"lodash/set";import S from"papaparse";import _ from"lodash/findKey";const A={errors:{fileRequired:"A file is required",invalidMimeType:"Invalid file type"},toggleHeaders:"File has headers",submitBtn:"Submit",fieldColumn:"Field",csvColumn:"Column",requiredField:"*",excludeField:"Exclude field"};var F={props:{modelValue:Array,fields:{type:[Object,Array],required:!0},text:{default:()=>({})}},setup(l,{emit:r}){let o=a({errors:[],inputName:"csv",file:null,map:{},value:{},fields:(u=l.fields,M(u)?k(u,(e=>({key:e,label:e,required:!0}))):k(u,((e,a)=>({key:a,label:D(e,"label",e),required:D(e,"required",!0)})))),fileHasHeaders:null,csvSample:null,rawCsv:null,language:e({},A,l.text),firstSampleRow:t((()=>M(o.csvSample)&&M(o.csvSample[0])?o.csvSample[0]:null)),allFieldsAreMapped:t((()=>x(o.fields,(function(e){return void 0!==o.map[e.key]||!e.required}))))});var u;return s("VueCsvImportData",o),s("buildMappedCsv",(function(){let e=o.fileHasHeaders?o.rawCsv:I(o.rawCsv);o.value=k(e,(e=>{let a={};return H(o.map,((t,s)=>{w(a,s,D(e,t))})),a})),r("update:modelValue",o.value)})),{VueCsvImportData:o}}};F.render=function(e,a,t,s,r,o){return l(e.$slots,"default",{errors:s.VueCsvImportData.errors,fields:s.VueCsvImportData.fields,file:s.VueCsvImportData.file})},F.__file="src/components/VueCsvImport.vue";var $={name:"VueCsvFiles",setup:()=>({VueCsvImportData:r("VueCsvImportData")})};$.render=function(e,a,t,s,r,v){return l(e.$slots,"default",{errors:s.VueCsvImportData.errors.value},(()=>[(o(!0),u(n,null,i(s.VueCsvImportData.errors,(a=>(o(),u("span",p(m(e.$attrs)),d(a),17)))),256))]))},$.__file="src/components/VueCsvErrors.vue";const T={"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]}};var q={name:"CsvFile",props:{name:{type:String,default:"csv"},headers:{type:[Boolean,null],default:!0},parseConfig:{type:Object,default:()=>({})},validation:{type:Boolean,default:!0},fileMimeTypes:{type:Array,default:()=>["text/csv","text/x-csv","application/vnd.ms-excel","text/plain"]}},setup(a){const t=v(null),s=r("VueCsvImportData"),l=r("buildMappedCsv"),o=s.language;s.inputName=name,s.fileHasHeaders=null!==a.headers?!!a.headers:null;const u=function(e){if(s.errors=[],e||s.errors.push(o.errors.fileRequired),a.validation){const t=""===e.type?function(e){if(!e||"string"!=typeof e)return!1;let a=e.split(".").pop();return a&&_(T,(e=>e.extensions.includes(a)))||!1}(e.name):e.type;return a.fileMimeTypes.includes(t)||s.errors.push(o.errors.invalidMimeType),0===s.errors.length}return!0};return c((()=>s.file),(t=>{t||(s.csvSample.value=null,s.rawCsv.value=null);let l=new FileReader;l.readAsText(s.file,a.parseConfig.encoding||"UTF-8"),l.onload=function(t){s.csvSample=D(S.parse(t.target.result,e({preview:10,skipEmptyLines:!0},a.parseConfig)),"data"),s.rawCsv=D(S.parse(t.target.result,e({skipEmptyLines:!0},a.parseConfig)),"data")},l.onerror=function(e){console.log(e)}}),{deep:!0}),c((()=>s.fileHasHeaders),(()=>{s.allFieldsAreMapped&&l()})),{file:s.file,change:function(){let e=t.value.files?t.value.files[0]:null;u(e)&&(s.file=e)},csvRef:t}}};const R=["name"];q.render=function(e,a,t,s,r,o){return l(e.$slots,"default",{file:s.file,change:s.change},(()=>[f("input",b({ref:"csvRef",type:"file",onChange:a[0]||(a[0]=(...e)=>s.change&&s.change(...e)),name:t.name},e.$attrs),null,16,R)]))},q.__file="src/components/VueCsvInput.vue";var E={name:"CsvMap",props:{noThead:{type:Boolean,default:!1},selectAttributes:{type:Object,default:()=>({})},autoMatch:{type:Boolean,default:!0},autoMatchIgnoreCase:{type:Boolean,default:!0}},setup(e){const a=r("VueCsvImportData"),t=r("buildMappedCsv"),s=a.language;return c((()=>a.map),(function(){a.allFieldsAreMapped&&t()}),{deep:!0}),e.autoMatch&&c((()=>a.csvSample),(function(t){t&&a.fields.forEach((s=>{t[0].forEach(((t,l)=>{(e.autoMatchIgnoreCase?s.label.toLowerCase().trim():s.label.trim())===(e.autoMatchIgnoreCase?t.toLowerCase().trim():t.trim())&&(a.map[s.key]=l)}))}))})),{VueCsvImportData:a,labels:s}}};const B={key:0},L=["name","onUpdate:modelValue"],j={key:0,value:null},O=["value"];E.render=function(e,a,t,s,r,m){return l(e.$slots,"default",{sample:s.VueCsvImportData.firstSampleRow,map:s.VueCsvImportData.map,fields:s.VueCsvImportData.fields},(()=>[s.VueCsvImportData.firstSampleRow?(o(),u("table",p(b({key:0},e.$attrs)),[t.noThead?C("v-if",!0):(o(),u("thead",B,[f("tr",null,[f("th",null,d(s.labels.fieldColumn),1),f("th",null,d(s.labels.csvColumn),1)])])),f("tbody",null,[(o(!0),u(n,null,i(s.VueCsvImportData.fields,((e,a)=>(o(),u("tr",{key:a},[f("td",null,d(e.label),1),f("td",null,[g(f("select",b(t.selectAttributes,{name:`csv_uploader_map_${a}`,"onUpdate:modelValue":a=>s.VueCsvImportData.map[e.key]=a}),[e.required?C("v-if",!0):(o(),u("option",j,"Â ")),(o(!0),u(n,null,i(s.VueCsvImportData.firstSampleRow,((e,a)=>(o(),u("option",{key:a,value:a},d(e),9,O)))),128))],16,L),[[y,s.VueCsvImportData.map[e.key]]])])])))),128))])],16)):C("v-if",!0)]))},E.__file="src/components/VueCsvMap.vue";var U={name:"CsvTableMap",props:{tableAttributes:{type:Object,default:()=>({})},autoMatch:{type:Boolean,default:!0},autoMatchIgnoreCase:{type:Boolean,default:!0}},setup(e){const s=r("VueCsvImportData"),l=r("buildMappedCsv"),o=s.language,u=a({}),n=t((()=>s.fields.map((e=>(e.selected=Object.values(u).includes(e.label),e)))));c((()=>u),(function(){s.map={};for(const[e,a]of Object.entries(u))""!==a&&(s.map[a.toLowerCase()]=e);s.allFieldsAreMapped&&l()}),{deep:!0});const i=t((()=>s.fileHasHeaders?s.csvSample:s.csvSample.slice(1))),p=t((()=>s.fileHasHeaders?[...Array(s.firstSampleRow.length).keys()].map((e=>`${o.csvColumn} ${e}`)):s.firstSampleRow));return e.autoMatch&&c((()=>s.csvSample),(function(a){a&&s.fields.forEach((t=>{a[0].forEach(((a,s)=>{(e.autoMatchIgnoreCase?t.label.toLowerCase().trim():t.label.trim())===(e.autoMatchIgnoreCase?a.toLowerCase().trim():a.trim())&&(u[s]=t.label)}))}))})),{availableFields:n,csvMap:u,csvSample:i,headers:p,VueCsvImportData:s,labels:o}}};const N={key:0,class:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg"},K={class:"bg-gray-50"},z={class:"divide-x divide-gray-200"},G=["onUpdate:modelValue","name"],J={value:""},P=["value","disabled"],Q=["value"],W={class:"divide-y divide-gray-200 bg-white"},X={class:"truncate"};U.render=function(e,a,t,s,r,p){return l(e.$slots,"default",{sample:s.VueCsvImportData.firstSampleRow,map:s.VueCsvImportData.map,fields:s.VueCsvImportData.fields},(()=>[s.VueCsvImportData.firstSampleRow?(o(),u("div",N,[f("table",b(t.tableAttributes,{class:"min-w-full divide-y divide-gray-300 overflow-x-scroll"}),[f("thead",K,[f("tr",z,[(o(!0),u(n,null,i(s.headers,((e,a)=>(o(),u("th",{scope:"col",class:"py-3.5 pl-4 pr-4 text-left text-sm font-semibold text-gray-900 sm:pl-6",key:e},[h(d(e)+" ",1),g(f("select",{"onUpdate:modelValue":e=>s.csvMap[a]=e,name:`csv_uploader_map_${a}`,required:"",class:"rounded-md overflow-hidden px-4 py-[10px] text-gray-900 dark:text-gray-400"},[f("option",J,d(s.labels.excludeField),1),(o(!0),u(n,null,i(s.availableFields,(e=>(o(),u("option",{value:e.label,key:e.key,disabled:e.selected},d(e.label)+" "+d(e.required?s.labels.requiredField:""),9,P)))),128)),s.VueCsvImportData.fields.map((e=>e.label)).includes(e)?C("v-if",!0):(o(),u("option",{value:e,key:e},d(e),9,Q))],8,G),[[y,s.csvMap[a]]])])))),128))])]),f("tbody",W,[(o(!0),u(n,null,i(s.csvSample,((e,a)=>(o(),u("tr",{class:"divide-x divide-gray-200",key:a},[(o(!0),u(n,null,i(e,((e,a)=>(o(),u("td",{class:"whitespace-nowrap py-4 pl-4 pr-4 text-sm font-medium text-gray-900 sm:pl-6",key:a},[f("span",X,d(e),1)])))),128))])))),128))])],16)])):C("v-if",!0)]))},U.__file="src/components/VueCsvTableMap.vue";var Y={name:"VueCsvImportSubmit",setup(e,a){const t=r("VueCsvImportData"),s=r("buildMappedCsv"),l=t.language;return{submit:function(){s(),a.emit("submit",t.value)},VueCsvImportData:t,labels:l}}};Y.render=function(e,a,t,s,r,o){return l(e.$slots,"submit",{submit:s.submit,mappedCsv:s.VueCsvImportData.value},(()=>[f("button",b({id:"submit",type:"submit"},e.$attrs,{onClick:a[0]||(a[0]=V(((...e)=>s.submit&&s.submit(...e)),["prevent"]))}),d(s.labels.submitBtn),17)]))},Y.__file="src/components/VueCsvSubmit.vue";var Z={name:"ToggleHasHeaders",props:{labelAttributes:{},checkboxAttributes:{}},setup(){const e=r("VueCsvImportData"),a=e.language;return{VueCsvImportData:e,toggleHasHeaders:function(){e.fileHasHeaders=!e.fileHasHeaders},labels:a}}};const ee=["value"];Z.render=function(e,a,t,s,r,o){return l(e.$slots,"default",{hasHeaders:s.VueCsvImportData.fileHasHeaders,toggle:s.toggleHasHeaders},(()=>[f("label",b({id:"labelCheckbox"},t.labelAttributes),[f("input",b({id:"buttonCheckbox",type:"checkbox"},t.checkboxAttributes,{value:s.VueCsvImportData.fileHasHeaders,onChange:a[0]||(a[0]=(...e)=>s.toggleHasHeaders&&s.toggleHasHeaders(...e))}),null,16,ee),h(" "+d(s.labels.toggleHeaders),1)],16)]))},Z.__file="src/components/VueCsvToggleHeaders.vue";const ae={install(a,t){t=e({components:{"vue-csv-import":"vue-csv-import","vue-csv-errors":"vue-csv-errors","vue-csv-input":"vue-csv-input","vue-csv-map":"vue-csv-map","vue-csv-table-map":"vue-csv-table-map","vue-csv-submit":"vue-csv-submit","vue-csv-toggle-headers":"vue-csv-toggle-headers"}},t),a.component(t.components["vue-csv-import"],F),a.component(t.components["vue-csv-errors"],$),a.component(t.components["vue-csv-input"],q),a.component(t.components["vue-csv-map"],E),a.component(t.components["vue-csv-table-map"],U),a.component(t.components["vue-csv-submit"],Y),a.component(t.components["vue-csv-toggle-headers"],Z)}};export{$ as VueCsvErrors,F as VueCsvImport,ae as VueCsvImportPlugin,q as VueCsvInput,E as VueCsvMap,Y as VueCsvSubmit,U as VueCsvTableMap,Z as VueCsvToggleHeaders};
