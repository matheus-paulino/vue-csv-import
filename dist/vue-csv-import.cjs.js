"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("lodash/merge"),t=require("vue"),a=require("lodash/drop"),l=require("lodash/every"),r=require("lodash/forEach"),s=require("lodash/get"),o=require("lodash/isArray"),n=require("lodash/map"),u=require("lodash/set"),i=require("papaparse"),p=require("lodash/findKey");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=c(e),m=c(a),v=c(l),f=c(r),g=c(s),b=c(o),C=c(n),y=c(u),V=c(i),h=c(p);const k={errors:{fileRequired:"A file is required",invalidMimeType:"Invalid file type"},toggleHeaders:"File has headers",submitBtn:"Submit",fieldColumn:"Field",csvColumn:"Column",requiredField:"*",excludeField:"Exclude field"};var x={props:{modelValue:Array,fields:{type:[Object,Array],required:!0},text:{default:()=>({})}},setup(e,{emit:a}){let l=t.reactive({errors:[],inputName:"csv",file:null,map:{},value:{},fields:(r=e.fields,b.default(r)?C.default(r,(e=>({key:e,label:e,required:!0}))):C.default(r,((e,t)=>({key:t,label:g.default(e,"label",e),required:g.default(e,"required",!0)})))),fileHasHeaders:null,csvSample:null,rawCsv:null,language:d.default({},k,e.text),firstSampleRow:t.computed((()=>b.default(l.csvSample)&&b.default(l.csvSample[0])?l.csvSample[0]:null)),allFieldsAreMapped:t.computed((()=>v.default(l.fields,(function(e){return void 0!==l.map[e.key]||!e.required}))))});var r;return t.provide("VueCsvImportData",l),t.provide("buildMappedCsv",(function(){let e=l.fileHasHeaders?l.rawCsv:m.default(l.rawCsv);l.value=C.default(e,(e=>{let t={};return f.default(l.map,((a,l)=>{y.default(t,l,g.default(e,a))})),t})),a("update:modelValue",l.value)})),{VueCsvImportData:l}}};x.render=function(e,a,l,r,s,o){return t.renderSlot(e.$slots,"default",{errors:r.VueCsvImportData.errors,fields:r.VueCsvImportData.fields,file:r.VueCsvImportData.file})},x.__file="src/components/VueCsvImport.vue";var D={name:"VueCsvFiles",setup:()=>({VueCsvImportData:t.inject("VueCsvImportData")})};D.render=function(e,a,l,r,s,o){return t.renderSlot(e.$slots,"default",{errors:r.VueCsvImportData.errors.value},(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.VueCsvImportData.errors,(a=>(t.openBlock(),t.createElementBlock("span",t.normalizeProps(t.guardReactiveProps(e.$attrs)),t.toDisplayString(a),17)))),256))]))},D.__file="src/components/VueCsvErrors.vue";const B={"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]}};var E={name:"CsvFile",props:{name:{type:String,default:"csv"},headers:{type:[Boolean,null],default:!0},parseConfig:{type:Object,default:()=>({})},validation:{type:Boolean,default:!0},fileMimeTypes:{type:Array,default:()=>["text/csv","text/x-csv","application/vnd.ms-excel","text/plain"]}},setup(e){const a=t.ref(null),l=t.inject("VueCsvImportData"),r=t.inject("buildMappedCsv"),s=l.language;l.inputName=name,l.fileHasHeaders=null!==e.headers?!!e.headers:null;const o=function(t){if(l.errors=[],t||l.errors.push(s.errors.fileRequired),e.validation){const a=""===t.type?function(e){if(!e||"string"!=typeof e)return!1;let t=e.split(".").pop();return t&&h.default(B,(e=>e.extensions.includes(t)))||!1}(t.name):t.type;return e.fileMimeTypes.includes(a)||l.errors.push(s.errors.invalidMimeType),0===l.errors.length}return!0};return t.watch((()=>l.file),(t=>{t||(l.csvSample.value=null,l.rawCsv.value=null);let a=new FileReader;a.readAsText(l.file,e.parseConfig.encoding||"UTF-8"),a.onload=function(t){l.csvSample=g.default(V.default.parse(t.target.result,d.default({preview:10,skipEmptyLines:!0},e.parseConfig)),"data"),l.rawCsv=g.default(V.default.parse(t.target.result,d.default({skipEmptyLines:!0},e.parseConfig)),"data")},a.onerror=function(e){console.log(e)}}),{deep:!0}),t.watch((()=>l.fileHasHeaders),(()=>{l.allFieldsAreMapped&&r()})),{file:l.file,change:function(){let e=a.value.files?a.value.files[0]:null;o(e)&&(l.file=e)},csvRef:a}}};const I=["name"];E.render=function(e,a,l,r,s,o){return t.renderSlot(e.$slots,"default",{file:r.file,change:r.change},(()=>[t.createElementVNode("input",t.mergeProps({ref:"csvRef",type:"file",onChange:a[0]||(a[0]=(...e)=>r.change&&r.change(...e)),name:l.name},e.$attrs),null,16,I)]))},E.__file="src/components/VueCsvInput.vue";var S={name:"CsvMap",props:{noThead:{type:Boolean,default:!1},selectAttributes:{type:Object,default:()=>({})},autoMatch:{type:Boolean,default:!0},autoMatchIgnoreCase:{type:Boolean,default:!0}},setup(e){const a=t.inject("VueCsvImportData"),l=t.inject("buildMappedCsv"),r=a.language;return t.watch((()=>a.map),(function(){a.allFieldsAreMapped&&l()}),{deep:!0}),e.autoMatch&&t.watch((()=>a.csvSample),(function(t){t&&a.fields.forEach((l=>{t[0].forEach(((t,r)=>{(e.autoMatchIgnoreCase?l.label.toLowerCase().trim():l.label.trim())===(e.autoMatchIgnoreCase?t.toLowerCase().trim():t.trim())&&(a.map[l.key]=r)}))}))})),{VueCsvImportData:a,labels:r}}};const w={key:0},M=["name","onUpdate:modelValue"],H={key:0,value:null},N=["value"];S.render=function(e,a,l,r,s,o){return t.renderSlot(e.$slots,"default",{sample:r.VueCsvImportData.firstSampleRow,map:r.VueCsvImportData.map,fields:r.VueCsvImportData.fields},(()=>[r.VueCsvImportData.firstSampleRow?(t.openBlock(),t.createElementBlock("table",t.normalizeProps(t.mergeProps({key:0},e.$attrs)),[l.noThead?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createElementBlock("thead",w,[t.createElementVNode("tr",null,[t.createElementVNode("th",null,t.toDisplayString(r.labels.fieldColumn),1),t.createElementVNode("th",null,t.toDisplayString(r.labels.csvColumn),1)])])),t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.VueCsvImportData.fields,((e,a)=>(t.openBlock(),t.createElementBlock("tr",{key:a},[t.createElementVNode("td",null,t.toDisplayString(e.label),1),t.createElementVNode("td",null,[t.withDirectives(t.createElementVNode("select",t.mergeProps(l.selectAttributes,{name:`csv_uploader_map_${a}`,"onUpdate:modelValue":t=>r.VueCsvImportData.map[e.key]=t}),[e.required?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createElementBlock("option",H,"Â ")),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.VueCsvImportData.firstSampleRow,((e,a)=>(t.openBlock(),t.createElementBlock("option",{key:a,value:a},t.toDisplayString(e),9,N)))),128))],16,M),[[t.vModelSelect,r.VueCsvImportData.map[e.key]]])])])))),128))])],16)):t.createCommentVNode("v-if",!0)]))},S.__file="src/components/VueCsvMap.vue";var q={name:"CsvTableMap",props:{tableAttributes:{type:Object,default:()=>({})},autoMatch:{type:Boolean,default:!0},autoMatchIgnoreCase:{type:Boolean,default:!0}},setup(e){const a=t.inject("VueCsvImportData"),l=t.inject("buildMappedCsv"),r=a.language,s=t.reactive({}),o=t.computed((()=>a.fields.map((e=>(e.selected=Object.values(s).includes(e.label),e)))));t.watch((()=>s),(function(){a.map={};for(const[e,t]of Object.entries(s))""!==t&&(a.map[t.toLowerCase()]=e);a.allFieldsAreMapped&&l()}),{deep:!0});const n=t.computed((()=>a.fileHasHeaders?a.csvSample:a.csvSample.slice(1))),u=t.computed((()=>a.fileHasHeaders?[...Array(a.firstSampleRow.length).keys()].map((e=>`${r.csvColumn} ${e}`)):a.firstSampleRow));return e.autoMatch&&t.watch((()=>a.csvSample),(function(t){t&&a.fields.forEach((a=>{t[0].forEach(((t,l)=>{(e.autoMatchIgnoreCase?a.label.toLowerCase().trim():a.label.trim())===(e.autoMatchIgnoreCase?t.toLowerCase().trim():t.trim())&&(s[l]=a.label)}))}))})),{availableFields:o,csvMap:s,csvSample:n,headers:u,VueCsvImportData:a,labels:r}}};const F={key:0,class:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg"},_={class:"bg-gray-50"},A={class:"divide-x divide-gray-200"},j=["onUpdate:modelValue","name"],T={value:""},$=["value","disabled"],L=["value"],R={class:"divide-y divide-gray-200 bg-white"},P={class:"truncate"};q.render=function(e,a,l,r,s,o){return t.renderSlot(e.$slots,"default",{sample:r.VueCsvImportData.firstSampleRow,map:r.VueCsvImportData.map,fields:r.VueCsvImportData.fields},(()=>[r.VueCsvImportData.firstSampleRow?(t.openBlock(),t.createElementBlock("div",F,[t.createElementVNode("table",t.mergeProps(l.tableAttributes,{class:"min-w-full divide-y divide-gray-300 overflow-x-scroll"}),[t.createElementVNode("thead",_,[t.createElementVNode("tr",A,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.headers,((e,a)=>(t.openBlock(),t.createElementBlock("th",{scope:"col",class:"py-3.5 pl-4 pr-4 text-left text-sm font-semibold text-gray-900 sm:pl-6",key:e},[t.createTextVNode(t.toDisplayString(e)+" ",1),t.withDirectives(t.createElementVNode("select",{"onUpdate:modelValue":e=>r.csvMap[a]=e,name:`csv_uploader_map_${a}`,required:"",class:"rounded-md overflow-hidden px-4 py-[10px] text-gray-900 dark:text-gray-400"},[t.createElementVNode("option",T,t.toDisplayString(r.labels.excludeField),1),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.availableFields,(e=>(t.openBlock(),t.createElementBlock("option",{value:e.label,key:e.key,disabled:e.selected},t.toDisplayString(e.label)+" "+t.toDisplayString(e.required?r.labels.requiredField:""),9,$)))),128)),r.VueCsvImportData.fields.map((e=>e.label)).includes(e)?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createElementBlock("option",{value:e,key:e},t.toDisplayString(e),9,L))],8,j),[[t.vModelSelect,r.csvMap[a]]])])))),128))])]),t.createElementVNode("tbody",R,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(r.csvSample,((e,a)=>(t.openBlock(),t.createElementBlock("tr",{class:"divide-x divide-gray-200",key:a},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e,((e,a)=>(t.openBlock(),t.createElementBlock("td",{class:"whitespace-nowrap py-4 pl-4 pr-4 text-sm font-medium text-gray-900 sm:pl-6",key:a},[t.createElementVNode("span",P,t.toDisplayString(e),1)])))),128))])))),128))])],16)])):t.createCommentVNode("v-if",!0)]))},q.__file="src/components/VueCsvTableMap.vue";var O={name:"VueCsvImportSubmit",setup(e,a){const l=t.inject("VueCsvImportData"),r=t.inject("buildMappedCsv"),s=l.language;return{submit:function(){r(),a.emit("submit",l.value)},VueCsvImportData:l,labels:s}}};O.render=function(e,a,l,r,s,o){return t.renderSlot(e.$slots,"submit",{submit:r.submit,mappedCsv:r.VueCsvImportData.value},(()=>[t.createElementVNode("button",t.mergeProps({id:"submit",type:"submit"},e.$attrs,{onClick:a[0]||(a[0]=t.withModifiers(((...e)=>r.submit&&r.submit(...e)),["prevent"]))}),t.toDisplayString(r.labels.submitBtn),17)]))},O.__file="src/components/VueCsvSubmit.vue";var U={name:"ToggleHasHeaders",props:{labelAttributes:{},checkboxAttributes:{}},setup(){const e=t.inject("VueCsvImportData"),a=e.language;return{VueCsvImportData:e,toggleHasHeaders:function(){e.fileHasHeaders=!e.fileHasHeaders},labels:a}}};const z=["value"];U.render=function(e,a,l,r,s,o){return t.renderSlot(e.$slots,"default",{hasHeaders:r.VueCsvImportData.fileHasHeaders,toggle:r.toggleHasHeaders},(()=>[t.createElementVNode("label",t.mergeProps({id:"labelCheckbox"},l.labelAttributes),[t.createElementVNode("input",t.mergeProps({id:"buttonCheckbox",type:"checkbox"},l.checkboxAttributes,{value:r.VueCsvImportData.fileHasHeaders,onChange:a[0]||(a[0]=(...e)=>r.toggleHasHeaders&&r.toggleHasHeaders(...e))}),null,16,z),t.createTextVNode(" "+t.toDisplayString(r.labels.toggleHeaders),1)],16)]))},U.__file="src/components/VueCsvToggleHeaders.vue";const K={install(e,t){t=d.default({components:{"vue-csv-import":"vue-csv-import","vue-csv-errors":"vue-csv-errors","vue-csv-input":"vue-csv-input","vue-csv-map":"vue-csv-map","vue-csv-table-map":"vue-csv-table-map","vue-csv-submit":"vue-csv-submit","vue-csv-toggle-headers":"vue-csv-toggle-headers"}},t),e.component(t.components["vue-csv-import"],x),e.component(t.components["vue-csv-errors"],D),e.component(t.components["vue-csv-input"],E),e.component(t.components["vue-csv-map"],S),e.component(t.components["vue-csv-table-map"],q),e.component(t.components["vue-csv-submit"],O),e.component(t.components["vue-csv-toggle-headers"],U)}};exports.VueCsvErrors=D,exports.VueCsvImport=x,exports.VueCsvImportPlugin=K,exports.VueCsvInput=E,exports.VueCsvMap=S,exports.VueCsvSubmit=O,exports.VueCsvTableMap=q,exports.VueCsvToggleHeaders=U;
